import React, { Component } from "react";import { connect } from "react-redux";import * as actions from "../../actions";import { Dimensions, Text, View } from "react-native";import { Button } from "react-native-elements";import ModalSpinner from "../../components/Common/ModalSpinner";import { firedb } from "../../modules/firebase";import GeoFire from "geofire";const { height: SCREEN_HEIGHT, width: SCREEN_WIDTH } = Dimensions.get("window");class Test extends Component {  constructor(props) {    super(props);    this.state = {      dataLoading: false,      orgsGeoList: [],      petsNearby: {},      searchParams: {        species: "Cat"      }    };    this.geoFire = new GeoFire(firedb.ref("orgs"));    this.geoQuery = this.geoFire.query({      center: [0, 0],      radius: 0    });    this.orgsGeoList = [];    this.geoQuery.on("ready", () => {      this.orgsGeoList.map(org => {        this.props.fetchNearbyPets(org.key, this.state.searchParams);        this.props.fetchOrgDetail(org.key);      });      //this.props.fetchNearbyPets(this.orgsGeoList);      console.log("ready");      this.setState({ orgsGeoList: this.orgsGeoList, dataLoading: false });      //this.geoQuery.cancel()    });    this.geoQuery.on("key_entered", (key, location, distance) => {      this.setState({ dataLoading: true });      console.log("key_entered", key);      this.orgsGeoList.push({ key, distance });      /*await firestore       .collection("orgs")       .doc(`${key}`)       .get()       .then(doc => this.orgsGeoList.push(doc.data()))       .catch(err=>console.log('firestore err: ',err))       ;*/      //console.log('key_entered: ',firestore.collection('orgs').doc(key).name)    });    this.geoQuery.on("key_exited", key => {      this.setState({ dataLoading: true });      this.orgsGeoList = _.remove(this.orgsGeoList, n => {        return n.key === key;      });    });  }  /*static getDerivedStateFromProps(props, state) {    if (props.petsNearby) {      return { petsNearby: props.petsNearby };    }  }*/  /*fetchOrgsAndPetsDetail = geoArray => {    if (!geoArray.length) return {};    let temp = {};    geoArray.map(geo => {      temp[geo.key] = [];      firestore        .collection("pets")        .where("orgID", "==", geo.key)        .get()        .then(querySnapshot => {          querySnapshot.forEach(doc => {            if (doc.exists) {              //console.log("doc found: ", geo.key, doc.id);              temp[geo.key].push(doc.data());            } else {              console.log("no doc: ", geo.key);            }          });        }) //temp.push(doc.data()))        .catch(err => console.log("firestore err: ", err));    });    console.log("temp");    return temp;  };*/  componentDidMount() {    navigator.geolocation.getCurrentPosition(pos => {      const longitude = pos.coords.longitude;      const latitude = pos.coords.latitude;      console.log(longitude, latitude);    });  }  /*componentDidUpdate(prevProps, prevState) {    if (prevProps.petsNearby !== this.props.petsNearby) {      this.forceUpdate();    }  }*/  updateCriteria = (lat, lng, rad) => {    this.geoQuery.updateCriteria({      center: [lat, lng],      radius: rad    });  };  onImageLoadEnd = () => {    this.setState({ dataLoading: false });  };  render() {    return (      <View style={{ flex: 1 }}>        {this.state.dataLoading && (          <ModalSpinner visible={this.state.dataLoading} transparent={true} animationType={"none"} setLoadingFalse={this.setLoadingFalse} />        )}        <View>          <Text>Organizations found: {this.state.orgsGeoList.length}</Text>          <View style={{ flex: 1 }} />          <Button            title={"search"}            onPress={() => {              this.updateCriteria(37, -122, 50);              this.props.navigation.navigate("explorePetsList");            }}          />        </View>      </View>    );  }}export default connect(null, actions)(Test);